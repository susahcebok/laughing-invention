<!doctype html>
<html>
<head>
<title>PFP GENERATOR</title>

<meta charset="utf-8" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="css/pfp.css">

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/camanjs/4.1.2/caman.full.min.js"></script>
</head>

<body>
<main>
<h1>PFP GENERATOR</h1>
<p>Bingkai profil Anda dengan warna perlawanan. Biarkan foto profil Anda berbicara banyak tentang perdamaian dan keadilan.</p>

<p>
<div class="image-upload">
<label for="file">
<p><img id="cvs" src="pilihfile.png"/></p>
</label>
<input id="file" type="file" accept="image/*" onchange="loadFile(event)" style="display:none;">
</div><!-- image-upload -->
</p>
	
<p id="output"></p>

<p>
<button id="download" onclick="canvasToPng()">Download</button>
<!-- <span id="share"></span> -->
<button onclick="shareCanvas()">Share</button>
<button id="clear">Clear</button>
</p>
</main>

<script type="text/javascript" src="js/share.js"></script>

<!-- Canvas -->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script>
var loadFile = function(event) {
var reader = new FileReader();
reader.onload = function() {
createOverlay(reader.result);
};
reader.readAsDataURL(event.target.files[0]);
};

var createOverlay = function(uploadImage) {
var baseImg = uploadImage;
Caman("#cvs", function () {
this.brightness(5).render();
this.newLayer(function() {
this.setBlendingMode("normal");
this.opacity(100);
this.overlayImage(baseImg);
});

this.newLayer(function() {
this.setBlendingMode("normal");
this.opacity(90);
this.overlayImage('picture.png');
});

$('#cvs').removeAttr('style');
});

$('#cvs').removeAttr('style');
};

function canvasToPng() {	
document.getElementById("share").innerHTML =
'<button onclick="clearCanvas()">Hapus</button> <button onclick="shareCanvas()">Share</button>';
const canvas = document.getElementById('cvs');
canvas.toBlob((blob) => {
const link = document.createElement("a");
link.href = URL.createObjectURL(blob);
link.download = "avatar.png";
link.click();
})
};


// function clearCanvas() {
// const  canvas = document.getElementById ("cvs");
// var context = canvas.getContext("2d");
// context.clearRect(0,0,canvas.width,canvas.height);
// image = null;
// canvas = null;
// imgFile = null;
// }

</script>

<script>
// Referneces
var control = $("#file"),
    clearBn = $("#clear");

// Setup the clear functionality
clearBn.on("click", function(){
    control.replaceWith( control.val('').clone( true ) );
});

// Some bound handlers to preserve when cloning
control.on({
    change: function(){ console.log( "Changed" ) },
     focus: function(){ console.log(  "Focus"  ) }
});
</script>

</body>
</html>
